<!DOCTYPE html>
<html lang="ja">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>六甲学院物理部2023</title>
<meta name="description" content="六甲学院物理部の2023年度オンライン文化祭非公式サイト">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://rokkophysicsclub.github.io/rpc-2023/css/root.css">
<link rel="stylesheet" href="https://rokkophysicsclub.github.io/rpc-2023/css/bootstrap.min.css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,300,700,400italic">
<link rel="stylesheet" href="https://rokkophysicsclub.github.io/rpc-2023/css/font-awesome.min.css">
<link rel="stylesheet" href="https://rokkophysicsclub.github.io/rpc-2023/css/owl.carousel.css">
<link rel="stylesheet" href="https://rokkophysicsclub.github.io/rpc-2023/css/owl.theme.css">
<link rel="stylesheet" href="https://rokkophysicsclub.github.io/rpc-2023/css/header.css">
<link rel="stylesheet" href="https://rokkophysicsclub.github.io/rpc-2023/css/link_card.css">
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<script type="text/x-mathjax-config">
 MathJax.Hub.Config({
 tex2jax: {
 inlineMath: [['$', '$'] ],
 displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
 }
 });
</script>


  <link href="https://rokkophysicsclub.github.io/rpc-2023/css/style.sea.css" rel="stylesheet" id="theme-stylesheet">

 

  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  


<link href="https://rokkophysicsclub.github.io/rpc-2023/css/custom.css" rel="stylesheet">
<link rel="shortcut icon" href="https://rokkophysicsclub.github.io/rpc-2023/img/favicon.png">


<header>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-MVYWYW3M9Z"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'G-MVYWYW3M9Z');
  </script>
<progress id="scroll_progress" style="width: 100vw;"></progress>
</header></head>
<body>
  <div id="all">
      <div class="container-fluid">
          <div class="row row-offcanvas row-offcanvas-left">
              <div id="sidebar" class="col-xs-6 col-sm-4 col-md-3 sidebar-offcanvas">
  <div class="sidebar-content">
    <h1 class="sidebar-heading"><a href="https://rokkophysicsclub.github.io/rpc-2023/">六甲学院物理部2023</a></h1>
    
      <p class="sidebar-p">六甲学院物理部の2023年度オンライン文化祭サイトです。（学校非公式）</p>
    
    <ul class="sidebar-menu">
      
        
        <li><a href="https://rokkophysicsclub.github.io/rpc-2023/welcome/">Welcome</a></li>
        
      
        
        <li><a href="https://rokkophysicsclub.github.io/rpc-2023/works/">Works</a></li>
        
      
        
        <li><a href="https://rokkophysicsclub.github.io/rpc-2023/links/">Links</a></li>
        
      
        
        <li><a href="https://rokkophysicsclub.github.io/rpc-2023/afterword/">Afterword</a></li>
        
      
        
        <hr size="1" style="margin-top: 15px;margin-bottom: 15px;">
        
      
        
        <li><a href="https://rokkophysicsclub.github.io/rpc-2023/members/">Members</a></li>
        
      
        
        <li><a href="https://rokkophysicsclub.github.io/rpc-2023/about/">About</a></li>
        
      
    </ul>
    <p class="social">
  
  
  
  <a href="https://twitter.com/rokkophysics" data-animate-hover="pulse" class="external twitter" title="Twitter" rel="me">
    <i class="fa fa-twitter"></i>
  </a>
  
  
  
  
  
  
  <a href="https://github.com/RokkoPhysicsClub" data-animate-hover="pulse" class="external" title="GitHub" rel="me">
    <i class="fa fa-github"></i>
  </a>
  
  
  
  <a href="https://www.youtube.com/channel/UCvLDGaFKdbpQ7vELdrUSyCw" data-animate-hover="pulse" class="external" title="YouTube" rel="me">
    <i class="fa fa-youtube"></i>
  </a>
  
  
</p>


    <div class="copyright">
      <p class="credit">
        
          &copy;2023 六甲学院物理部 |
        
        Template by <a href="https://bootstrapious.com/free-templates" class="external">Bootstrapious.com</a>

&amp; ported to Hugo by <a href="https://github.com/kishaningithub">Kishan B</a>

      </p>
    </div>
  </div>
</div>

              
<div class="col-xs-12 col-sm-8 col-md-9 content-column white-background">
  <div class="small-navbar visible-xs">
  <button type="button" data-toggle="offcanvas" class="btn btn-ghost pull-left"> <i class="fa fa-align-left"> </i>Menu</button>
  <h1 class="small-navbar-heading"><a href="https://rokkophysicsclub.github.io/rpc-2023/">六甲学院物理部2023</a></h1>
</div>

  <div class="row">
    <div class="col-lg-8">
      <div class="content-column-content">
         <h1>スパコン体験塾2023</h1>
         <div align="right">83rd 0x4C</div>
<h2 id="はじめに">はじめに</h2>
<p>今年の8/22~8/23にかけて開催された、スーパーコンピューター「富岳」を使ってセルオートマトンを計算するというイベントに参加したので、そのイベントの工程や内容などを書こうと思う。</p>
<h2 id="目次">目次</h2>
<p>スパコン体験塾で行ったことを纏めてみたところかなりの長文になってしまったので、目次を作成しておく。</p>
<ul>
<li><a href="#%E3%82%B9%E3%83%91%E3%82%B3%E3%83%B3%E4%BD%93%E9%A8%93%E5%A1%BE%E3%81%A8%E3%81%AF">スパコン体験塾とは</a></li>
<li><a href="#%E8%AA%B2%E9%A1%8C">課題</a>
<ul>
<li><a href="#%E8%AA%B2%E9%A1%8C14">課題1~4</a></li>
<li><a href="#%E8%AA%B2%E9%A1%8C58">課題5~8</a></li>
<li><a href="#%E8%AA%B2%E9%A1%8C912">課題9~12</a></li>
<li><a href="#%E8%AA%B2%E9%A1%8C13">課題13</a></li>
</ul>
</li>
<li><a href="#%E6%9C%80%E5%BE%8C%E3%81%AB">最後に</a></li>
</ul>
<h2 id="スパコン体験塾とは">スパコン体験塾とは</h2>
<p>スパコン体験塾は高度情報科学技術研究機構（RIST）が主催するイベントで、 参加者がスパコン「富岳」を使いながら与えられた課題を解くという内容となっている。<br>
今年はポートアイランドでの現地開催となった。<br></p>
<h3 id="スケジュール">スケジュール</h3>
<ul>
<li>1日目
<ul>
<li>~10:00 現地集合</li>
<li>10:00~17:00 富岳を使ってプログラミング</li>
</ul>
</li>
<li>2日目
<ul>
<li>~10:00 現地集合</li>
<li>10:00~12:30 プログラミング</li>
<li>12:30~14:00ぐらい 富岳についての講義など</li>
<li>14:00ぐらい~17:00 プログラミング</li>
</ul>
</li>
</ul>
<hr>
<h3 id="1日目">1日目</h3>
<p>1日目は主に富岳の使い方やセルオートマトンはどのようなものかなどの基本的な知識を教えてもらい、その後14個ある課題を解き始めた。<br>
1日目の朝はセルオートマトンの説明を担当していたRISTの方からただならぬオーラを感じたことが印象に残っている。<br>
今回は先ほど書いたように課題が14個あったのだが、内訳としては</p>
<ul>
<li>課題を解く準備×1</li>
<li>1次元初等セルオートマトン×4</li>
<li>2次元初等セルオートマトン×4</li>
<li>確率的セルオートマトン×4</li>
<li>並列計算×1</li>
</ul>
<p>となっており、個人的には課題を解く準備が一番難しかった。(<code>セグフォ</code>と言われているエラーに苦しめられた。)<br>
1日目の終わりにはなんとか課題3まで解き進めることができた。<br>
↓1日目に撮った写真たち
<img src="../../img/Cellular_automaton/PXL_20230822_061627678.avif" alt="01">
<img src="../../img/Cellular_automaton/PXL_20230822_061646182.avif" alt="02"></p>
<hr>
<h3 id="2日目">2日目</h3>
<p>2日目は並列計算の仕組みである<code>MPI</code>について学んでから課題を解き始めた。<br>
僕は普段Javaという言語を使って並列計算をすることが多いのだが、その時は</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(()-&gt;{</span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello Thread&#34;</span><span style="color:#f92672">);}).</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>
</span></span></code></pre></div><p>というように書く。<br>
しかし、MPIを使う場合は</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#a6e22e">MPI_Init</span>(NULL,NULL);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> myid;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">MPI_Comm_rank</span>(MPI_COMM_WORLD,<span style="color:#f92672">&amp;</span>myid);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;Hello world! I am in %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,myid);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">MPI_Finalize</span>();
</span></span></code></pre></div><p>と書くので、C言語らしさを感じた。<br>
<br>
昼過ぎからは、スパコン富岳の見学に行ってきた。<br>
<strong>理化学研究所計算科学研究センター</strong>にて富岳についての講義をしてもらったのだが、富岳はなかなかお金がかかるということやストレージ・メモリ関連などの詳しい話について知ることができた。<br>
講義の後、目の前にあったスクリーンが上がり、スクリーンの後ろの幕が開くと<strong>富岳が出てきた!!</strong><br>
<img src="../../img/Cellular_automaton/PXL_20230823_042947108.avif" alt="富岳(本物)">
なかなかの迫力である。<br>
富岳を見た後は集合写真を撮った。<br>
<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">スパコン「富岳」体験塾＠神戸　終了しました<br><br>「富岳」を　&quot;使って&quot;  &quot;見て&quot;、インパクトのある体験ができたでしょうか🥰?<br><br>今回は東京からも参加者がいました！<br>今までで一番いろんなエリアからご参加があり、好きなことを深く語り合えるお友達ができていました！<br>頑張るみんなが輝いていましたよ🥰 <a href="https://t.co/MUzlAOie2i">pic.twitter.com/MUzlAOie2i</a></p>&mdash; スーパーコンピュータ「富岳」(公式) (@Fugaku_hpci) <a href="https://twitter.com/Fugaku_hpci/status/1694261945296429300?ref_src=twsrc%5Etfw">August 23, 2023</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

見学から戻ってきてからはまた課題の続きを解き始め、僕が課題をすべて解き終わったぐらいでインタビューを受け、体験塾が終わった。<br>
(後日インタビューが公開されたらここにリンクを張る予定)<br>
体験塾の結果として、僕はすべての課題を何とか解き終わったのだが、一緒に参加していた部長が課題1の途中で&hellip;<strong>課題1!?</strong><br>
<br>
&hellip;<br>
<br>
見なかったことにしよう。</p>
<h2 id="課題">課題</h2>
<p>今回は、富岳を使って「セルオートマトン」というシミュレーションを行った。</p>
<h3 id="セルオートマトンとは">セルオートマトンとは</h3>
<blockquote>
<p>セル・オートマトン（英: cellular automaton、略称：CA）とは、格子状のセルと単純な規則による、離散的計算モデルである。計算可能性理論、数学、物理学、複雑適応系、数理生物学、微小構造モデリングなどの研究で利用される。非常に単純化されたモデルであるが、生命現象、結晶の成長、乱流といった複雑な自然現象を模した、驚くほどに豊かな結果を与えてくれる。-Wikipedia</p>
</blockquote>
<p>つまりは、マス目状に区切られた空間の中で全てのマスに同じルールを与えて時間を経過させることにより色々な現象をシミュレートできるというもの。</p>
<h2 id="課題14">課題1~4</h2>
<p>最初の課題として、1次元初等セルオートマトンというものを作った。</p>
<h3 id="1次元初等セルオートマトンとは">1次元初等セルオートマトンとは</h3>
<p>1次元初等セルオートマトンというのは、横一列にセルが並んだ状態のセルオートマトンのことで、今回は0と1の2つのステートを持つ。</p>
<blockquote>
<p><img src="../../img/Cellular_automaton/1d_automaton.jpg" alt="1d automaton"></p>
</blockquote>
<h3 id="ルール">ルール</h3>
<p>セルオートマトンでは、シミュレーションのために何らかのルールが必要になる。<br>
1次元初等セルオートマトンではルールとしてルール1~255があり、命名規則も決まっている。<br>
1次元セルオートマトンの基本的なルールとして、更新するときは中央のセルと隣接する2つのセルを参照する。<br>
このとき、それぞれのセルは2つのステートを持つので合計$$2^3=8$$個のステートを持つ。<br>
なので、更新する時はルールを2進数に直したものの右から<code>ステートを10進数に直した</code>番目の数字を参照する。</p>
<blockquote>
<p><img src="../../img/Cellular_automaton/1d_update.jpg" alt="1d_update">
<a href="https://onl.bz/xyAaFGa">https://onl.bz/xyAaFGa</a> より引用</p>
</blockquote>
<h3 id="空間">空間</h3>
<p>セルオートマトンには右端が左端と繋がるように空間が繰り返される「周期的」な空間と、右端と左端が固定されている「非周期的」な空間に分けられる。<br>
今回は周期的な空間を扱う。</p>
<h3 id="実装">実装</h3>
<p>今回は以下のような実装をした。</p>
<details>
<summary>ソースコード</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">rule_18</span>(<span style="color:#66d9ef">int</span> cell,<span style="color:#66d9ef">int</span><span style="color:#f92672">*</span> state){
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(state[<span style="color:#a6e22e">positive_mod</span>(cell<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,NCELLS)]<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(state[<span style="color:#a6e22e">positive_mod</span>(cell,NCELLS)]<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>){
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span>(state[<span style="color:#a6e22e">positive_mod</span>(cell<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>,NCELLS)]<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>){
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>            }<span style="color:#66d9ef">else</span>{
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }<span style="color:#66d9ef">else</span>{
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span>(state[<span style="color:#a6e22e">positive_mod</span>(cell<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>,NCELLS)]<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>){
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>            }<span style="color:#66d9ef">else</span>{
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }<span style="color:#66d9ef">else</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(state[<span style="color:#a6e22e">positive_mod</span>(cell,NCELLS)]<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>){
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span>(state[<span style="color:#a6e22e">positive_mod</span>(cell<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>,NCELLS)]<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>){
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>            }<span style="color:#66d9ef">else</span>{
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }<span style="color:#66d9ef">else</span>{
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span>(state[<span style="color:#a6e22e">positive_mod</span>(cell<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>,NCELLS)]<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>){
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>            }<span style="color:#66d9ef">else</span>{
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[]){
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> iseed <span style="color:#f92672">=</span> <span style="color:#ae81ff">18247349</span>;  <span style="color:#75715e">// random seed
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">double</span> ratio <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>;    <span style="color:#75715e">// ratio of state 1 in the initial state
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">int</span> i;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">int</span> istep;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">int</span> state[NSTEPS<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>][NCELLS] <span style="color:#f92672">=</span> {<span style="color:#ae81ff">0</span>};  <span style="color:#75715e">// array for states of cells
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">/* generate the initial state */</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">double</span> tmp;
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">srand</span>(iseed);
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> NCELLS; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>      tmp <span style="color:#f92672">=</span> (<span style="color:#66d9ef">double</span>)<span style="color:#a6e22e">rand</span>() <span style="color:#f92672">/</span> RAND_MAX;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (tmp <span style="color:#f92672">&lt;</span> ratio) {
</span></span><span style="display:flex;"><span>         state[<span style="color:#ae81ff">0</span>][i] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>         state[<span style="color:#ae81ff">0</span>][i] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">/* update the cell states */</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">for</span> (istep <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; istep <span style="color:#f92672">&lt;=</span> NSTEPS; istep<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> cell<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;cell<span style="color:#f92672">&lt;</span>NCELLS;cell<span style="color:#f92672">++</span>){
</span></span><span style="display:flex;"><span>          state[istep][cell]<span style="color:#f92672">=</span><span style="color:#a6e22e">rule_18</span>(cell,state[istep<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">outPGM</span>(<span style="color:#e6db74">&#34;output/out.pgm&#34;</span>,NSTEPS,NCELLS,state,<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">return</span> EXIT_SUCCESS;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></details>
<br>
流れとしては、
<ol>
<li>ランダムにセルを初期化</li>
<li>セルを更新</li>
<li>更新されたセル全体を出力</li>
</ol>
<p>となり、結果は以下のようになる。</p>
<blockquote>
<p><img src="../../img/Cellular_automaton/rule18.png" alt="rule18"></p>
</blockquote>
<p>課題4では以下の結果になった。</p>
<blockquote>
<p><img src="../../img/Cellular_automaton/CA_Title.png" alt="rule18_4"></p>
</blockquote>
<h2 id="課題58">課題5~8</h2>
<p>次の課題では2次元初等セルオートマトンを作った。</p>
<h3 id="2次元初等セルオートマトンとは">2次元初等セルオートマトンとは</h3>
<p>先ほどの1次元初等セルオートマトンを2次元に拡張したもの。</p>
<blockquote>
<p><img src="../../img/Cellular_automaton/2d_automaton.png" alt="2d automaton"></p>
</blockquote>
<h3 id="ルール-1">ルール</h3>
<p>2次元初等セルオートマトンではセルの更新において、フォン・ノイマン近傍とムーア近傍という2種類のサンプリング方法を使って更新する。</p>
<blockquote>
<p><img src="../../img/Cellular_automaton/2d_update.png" alt="2d update">
<a href="https://bagelee.com/programming/cellular-automaton/">https://bagelee.com/programming/cellular-automaton/</a> より引用</p>
</blockquote>
<h3 id="空間-1">空間</h3>
<p>2次元においても周期的な空間と非周期的な空間があり、周期的な空間はよくトーラスの形をしていると言われている。</p>
<h3 id="実装-1">実装</h3>
<p>今回は周期的な空間&amp;フォン・ノイマン近傍で実装した。</p>
<details>
<summary>ソースコード</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">ruleA</span>(<span style="color:#66d9ef">int</span> cell,<span style="color:#66d9ef">int</span> right,<span style="color:#66d9ef">int</span> left,<span style="color:#66d9ef">int</span> up,<span style="color:#66d9ef">int</span> down){
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (cell<span style="color:#f92672">==</span>((right<span style="color:#f92672">+</span>left<span style="color:#f92672">+</span>up<span style="color:#f92672">+</span>down)<span style="color:#f92672">%</span><span style="color:#ae81ff">2</span>))<span style="color:#f92672">?</span><span style="color:#ae81ff">0</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[]) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">//const int iseed = 70599102;  // random seed
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#75715e">//const double ratio = 0.03;   // ratio of state 1 in the initial state
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">int</span> i, j;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">int</span> istep;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">int</span> state[NCELLS][NCELLS];   <span style="color:#75715e">// array for states of cells
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">/* generate the initial state */</span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">//double tmp; 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#75715e">//srand(iseed);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> NCELLS; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> (j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> NCELLS; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>         <span style="color:#75715e">//tmp = (double)rand() / RAND_MAX;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>         state[i][j] <span style="color:#f92672">=</span> ((i<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>)<span style="color:#f92672">%</span><span style="color:#ae81ff">24</span><span style="color:#f92672">==</span><span style="color:#ae81ff">0</span><span style="color:#f92672">&amp;&amp;</span>(j<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>)<span style="color:#f92672">%</span><span style="color:#ae81ff">24</span><span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>)<span style="color:#f92672">?</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">/* output the initial state to a PGM file */</span>
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">outPGM</span>(<span style="color:#e6db74">&#34;output/state_0000.pgm&#34;</span>,NCELLS,NCELLS,state,<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">/* update the cell states */</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">for</span> (istep <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; istep <span style="color:#f92672">&lt;=</span> NSTEPS; istep<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> nextState[NCELLS][NCELLS];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> NCELLS; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">for</span>(j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> NCELLS; j<span style="color:#f92672">++</span>){
</span></span><span style="display:flex;"><span>              nextState[i][j]<span style="color:#f92672">=</span><span style="color:#a6e22e">ruleA</span>(state[i][j],state[i][<span style="color:#a6e22e">positive_mod</span>(j<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,NCELLS)],state[i][<span style="color:#a6e22e">positive_mod</span>(j<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>,NCELLS)],state[<span style="color:#a6e22e">positive_mod</span>(i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>,NCELLS)][j],state[<span style="color:#a6e22e">positive_mod</span>(i<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,NCELLS)][j]);
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>       }
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> NCELLS; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">for</span>(j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> NCELLS; j<span style="color:#f92672">++</span>){
</span></span><span style="display:flex;"><span>              state[i][j]<span style="color:#f92672">=</span>nextState[i][j];
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>       }
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">char</span> name[<span style="color:#ae81ff">50</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sprintf</span>(name,<span style="color:#e6db74">&#34;output/state_%04d.pgm&#34;</span>,istep);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">outPGM</span>(name,NCELLS,NCELLS,state,<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">return</span> EXIT_SUCCESS;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></details>
<br>
<p>流れとしては、</p>
<ol>
<li>セルを初期化</li>
<li>現在のステートの配列から次のステートの配列を計算</li>
<li>ステートを更新</li>
</ol>
<p>となっている。
結果は以下のようになった。</p>
<p><img src="../../img/Cellular_automaton/2d_result.avif" alt="2d_result"></p>
<h2 id="課題912">課題9~12</h2>
<p>課題9~12では確率的セルオートマトンを作った。</p>
<h3 id="確率的セルオートマトンとは">確率的セルオートマトンとは</h3>
<p>基本的には2次元初等セルオートマトンと同じでありながら、確率的に更新されるというもの。<br>
高度なシミュレーションに使われているらしい。</p>
<h3 id="実装-2">実装</h3>
<p>今回はムーア近傍&amp;非周期的な空間で実装した。</p>
<details>
<summary>ソースコード</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">ruleB</span>(<span style="color:#66d9ef">int</span> grid[<span style="color:#ae81ff">3</span>][<span style="color:#ae81ff">3</span>]){
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(((<span style="color:#66d9ef">double</span>)<span style="color:#a6e22e">rand</span>() <span style="color:#f92672">/</span> RAND_MAX)<span style="color:#f92672">&gt;=</span>P)<span style="color:#66d9ef">return</span> grid[<span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> z<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;i<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">3</span>;i<span style="color:#f92672">++</span>){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> j<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;j<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">3</span>;j<span style="color:#f92672">++</span>){
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span>(i<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span><span style="color:#f92672">&amp;&amp;</span>j<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>)<span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">double</span> b<span style="color:#f92672">=</span>(i<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>(i<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">+</span>(j<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>(j<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>            z<span style="color:#f92672">+=</span><span style="color:#a6e22e">floor</span>((grid[i][j]<span style="color:#f92672">*</span><span style="color:#ae81ff">2.0</span>)<span style="color:#f92672">/</span>b);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> ((<span style="color:#66d9ef">int</span>)z)<span style="color:#f92672">==</span><span style="color:#ae81ff">3</span><span style="color:#f92672">?</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>           ((<span style="color:#66d9ef">int</span>)z)<span style="color:#f92672">==</span><span style="color:#ae81ff">2</span><span style="color:#f92672">?</span>grid[<span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">1</span>]<span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[]){
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> iseed <span style="color:#f92672">=</span> <span style="color:#ae81ff">75099102</span>;  <span style="color:#75715e">// random seed
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">double</span> ratio <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>;    <span style="color:#75715e">// ratio of state 1 in initial state
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">int</span> i, j;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">int</span> istep;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">int</span> state[NCELLS][NCELLS];   <span style="color:#75715e">// array for states of cells
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">/* generate the initial state */</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">double</span> tmp;
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">srand</span>(iseed);
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> NCELLS; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> (j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> NCELLS; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>         tmp <span style="color:#f92672">=</span> (<span style="color:#66d9ef">double</span>)<span style="color:#a6e22e">rand</span>() <span style="color:#f92672">/</span> RAND_MAX;
</span></span><span style="display:flex;"><span>         <span style="color:#66d9ef">if</span> (tmp <span style="color:#f92672">&lt;</span> ratio) {
</span></span><span style="display:flex;"><span>            state[i][j] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>         } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            state[i][j] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>         }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>   } 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> NCELLS; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> (j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> NCELLS; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>         <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span> i <span style="color:#f92672">==</span> NCELLS <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>            state[i][j] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>         <span style="color:#66d9ef">if</span> (j <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span> j <span style="color:#f92672">==</span> NCELLS <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>            state[i][j] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">/* output the initial state to a PGM file */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">outPGM</span>(<span style="color:#e6db74">&#34;output/0.9/state_0000.pgm&#34;</span>,NCELLS,NCELLS,state,<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">/* update the cell states */</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">for</span> (istep <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; istep <span style="color:#f92672">&lt;=</span> NSTEPS; istep<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">int</span> nextState[NCELLS][NCELLS];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;</span> NCELLS<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">for</span>(j<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>;j<span style="color:#f92672">&lt;</span>NCELLS<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;j<span style="color:#f92672">++</span>){
</span></span><span style="display:flex;"><span>              <span style="color:#66d9ef">int</span> grid[<span style="color:#ae81ff">3</span>][<span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span>              <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> gi<span style="color:#f92672">=-</span><span style="color:#ae81ff">1</span>;gi<span style="color:#f92672">&lt;=</span><span style="color:#ae81ff">1</span>;gi<span style="color:#f92672">++</span>){
</span></span><span style="display:flex;"><span>                  <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> gf<span style="color:#f92672">=-</span><span style="color:#ae81ff">1</span>;gf<span style="color:#f92672">&lt;=</span><span style="color:#ae81ff">1</span>;gf<span style="color:#f92672">++</span>){
</span></span><span style="display:flex;"><span>                      grid[gi<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>][gf<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">=</span>state[i<span style="color:#f92672">+</span>gi][j<span style="color:#f92672">+</span>gf];
</span></span><span style="display:flex;"><span>                  }
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>              nextState[i][j]<span style="color:#f92672">=</span><span style="color:#a6e22e">ruleB</span>(grid);
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>       }
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;</span> NCELLS<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">for</span>(j<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>;j<span style="color:#f92672">&lt;</span>NCELLS<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;j<span style="color:#f92672">++</span>){
</span></span><span style="display:flex;"><span>              state[i][j]<span style="color:#f92672">=</span>nextState[i][j];
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>       }
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">char</span> name[<span style="color:#ae81ff">50</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sprintf</span>(name,<span style="color:#e6db74">&#34;output/0.9/state_%04d.pgm&#34;</span>,istep);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">outPGM</span>(name,NCELLS,NCELLS,state,<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">return</span> EXIT_SUCCESS;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></details>
<br>
<p>流れとしては2次元初等セルオートマトンとほぼ同じだが、次の状態の計算時に確率で更新せず元の値を戻すようにしてある。<br>
結果は以下のようになった。</p>
<p><img src="../../img/Cellular_automaton/S_2d_automaton.avif" alt="S_2d_automaton"></p>
<h2 id="課題13">課題13</h2>
<p>課題13では遂に富岳の並列計算が本領を発揮する。</p>
<h3 id="並列化">並列化</h3>
<p>富岳の膨大なコアを有効に扱うためには、プログラムを並列計算に対応させる必要がある。<br>
今回は、課題11(先ほど書いた課題)の更新確率を0.005刻みに変化させて最終ステップの変化を調べるというものだったので、コア数に応じてそれぞれのコアがどの確率の範囲を計算するか割り出すことによって並列化した。<br>
この仕組みは僕が去年制作したSimple_shooting_2.1というゲームの衝突判定の処理と同じなので実装にさほど手間はかからなかった。</p>
<h3 id="実装-3">実装</h3>
<p>実装においては課題11のmain関数内の処理をfor文で繰り返すというだけなので、その部分とルールの部分は省略させてもらう。</p>
<details>
<summary>ソースコード</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[]){
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">MPI_Init</span>(NULL,NULL);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> myid;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> nprocs;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">MPI_Comm_rank</span>(MPI_COMM_WORLD,<span style="color:#f92672">&amp;</span>myid);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">MPI_Comm_size</span>(MPI_COMM_WORLD,<span style="color:#f92672">&amp;</span>nprocs);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">float</span> N<span style="color:#f92672">=</span><span style="color:#ae81ff">192.0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">float</span> Ndiv<span style="color:#f92672">=</span>N<span style="color:#f92672">/</span>(<span style="color:#66d9ef">float</span>)nprocs;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> start<span style="color:#f92672">=</span>(<span style="color:#66d9ef">int</span>)<span style="color:#a6e22e">ceil</span>(Ndiv<span style="color:#f92672">*</span>myid);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> end<span style="color:#f92672">=</span>(<span style="color:#66d9ef">int</span>)<span style="color:#a6e22e">floor</span>(Ndiv<span style="color:#f92672">*</span>(myid<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> loop<span style="color:#f92672">=</span>start;loop<span style="color:#f92672">&lt;</span>end;loop<span style="color:#f92672">++</span>){
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Same as problem11.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">MPI_Finalize</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> EXIT_SUCCESS;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></details>
<br>
<p>このプログラムを実行するにあたって、富岳を1ノード分、つまりは48コアを使った。<br>
流石に僕のパソコンの8倍もある大量のコアを使ったおかげで、1コアでは時間のかかっていたプログラムが少し目を離しているうちにいつの間にか完了していた。<br>
結果も載せたかったのだがあまりにもファイルサイズが大きいので、気になる人は自分のパソコンや自前のサーバーなどで実行してみてほしい。</p>
<h2 id="最後に">最後に</h2>
<p>今回は、スパコン体験塾に初参加であったりC言語をあまり使ったことが無かったりして課題を終わらせることで精一杯になり追加の課題は出来なかったのだが、また機会があればスパコン体験塾に参加し、より多くの検証をしてみたい。<br></p>
<p>最後に、スパコン「富岳」を使う機会を提供してくださったRISTの方々に感謝します。ありがとうございました。</p>
<br>
<a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-hashtags="六甲学院物理部2023" data-lang="ja" data-show-count="false">#六甲学院物理部2023 でポスト</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
         
      </div>
    </div>
  </div>
</div>

          </div>
      </div>
  </div>
  <script src="https://rokkophysicsclub.github.io/rpc-2023/js/jquery.min.js"></script>
<script src="https://rokkophysicsclub.github.io/rpc-2023/js/bootstrap.min.js"></script>
<script src="https://rokkophysicsclub.github.io/rpc-2023/js/jquery.cookie.js"> </script>
<script src="https://rokkophysicsclub.github.io/rpc-2023/js/ekko-lightbox.js"></script>
<script src="https://rokkophysicsclub.github.io/rpc-2023/js/jquery.scrollTo.min.js"></script>
<script src="https://rokkophysicsclub.github.io/rpc-2023/js/masonry.pkgd.min.js"></script>
<script src="https://rokkophysicsclub.github.io/rpc-2023/js/imagesloaded.pkgd.min.js"></script>
<script src="https://rokkophysicsclub.github.io/rpc-2023/js/owl.carousel.min.js"></script>
<script src="https://rokkophysicsclub.github.io/rpc-2023/js/front.js"></script>
<script src="https://rokkophysicsclub.github.io/rpc-2023/js/jquery.xdomainajax.js"></script>
<script src="https://rokkophysicsclub.github.io/rpc-2023/js/header.js"></script>



</body>
</html>
